<p align="center">
    <img src="web/uploads/Logos/ico_01-10-2025.png" height="100px" alt="Hava Inventario Logo">
    <h1 align="center" style="font-weight: bold; background: linear-gradient(135deg, #71ce5d 0%, #2ab693 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Hava Inventario</h1>
    <br>
</p>

**Hava Inventario** es un sistema completo de gesti√≥n de inventarios desarrollado con [Yii 2](https://www.yiiframework.com/), dise√±ado para peque√±as y medianas empresas que necesitan un control eficiente de sus productos, ventas, clientes y facturaci√≥n.

El sistema incluye funcionalidades avanzadas como punto de venta (POS), gesti√≥n de clientes, control de stock en m√∫ltiples ubicaciones, facturaci√≥n, seguimiento de cobros, y conversi√≥n de monedas con precios del d√≥lar actualizables.

## üöÄ Caracter√≠sticas Principales

- **üì¶ Gesti√≥n de Productos**: Control completo de inventario con c√≥digos de barras, categor√≠as, im√°genes y precios
- **üè™ Sistema POS**: Punto de venta integrado con facturaci√≥n en tiempo real
- **üë• Gesti√≥n de Clientes**: Control de clientes con seguimiento de estado (solvente/moroso)
- **üìä Control de Stock**: Manejo de inventario en m√∫ltiples ubicaciones/almacenes
- **üí∞ Facturaci√≥n**: Sistema completo de facturas con items detallados
- **üìà Seguimiento de Cobros**: Control de cuentas por cobrar y pagos
- **üíµ Conversi√≥n de Monedas**: Precios del d√≥lar oficial y paralelo actualizables
- **üìã Hist√≥rico de Movimientos**: Registro completo de entradas, salidas y ventas
- **üîê Autenticaci√≥n Google**: Login con Google OAuth adem√°s de usuarios locales
- **üì± Interfaz Moderna**: Dise√±o responsive y amigable al usuario

## üìÅ Estructura del Proyecto

```
inventario-app/
‚îú‚îÄ‚îÄ assets/             # Definiciones de assets CSS/JS
‚îú‚îÄ‚îÄ commands/           # Comandos de consola
‚îú‚îÄ‚îÄ config/             # Configuraciones de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ db.php         # Configuraci√≥n de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ web.php        # Configuraci√≥n principal
‚îÇ   ‚îî‚îÄ‚îÄ google-credentials.php # Credenciales OAuth Google
‚îú‚îÄ‚îÄ controllers/        # Controladores de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ ProductosController.php    # Gesti√≥n de productos
‚îÇ   ‚îú‚îÄ‚îÄ ClientesController.php     # Gesti√≥n de clientes
‚îÇ   ‚îú‚îÄ‚îÄ FacturasController.php     # Gesti√≥n de facturas
‚îÇ   ‚îú‚îÄ‚îÄ PosController.php          # Sistema punto de venta
‚îÇ   ‚îú‚îÄ‚îÄ EntradasController.php     # Control de entradas
‚îÇ   ‚îú‚îÄ‚îÄ SalidasController.php      # Control de salidas
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ models/             # Modelos de datos (ActiveRecord)
‚îÇ   ‚îú‚îÄ‚îÄ Productos.php              # Modelo de productos
‚îÇ   ‚îú‚îÄ‚îÄ Clientes.php               # Modelo de clientes
‚îÇ   ‚îú‚îÄ‚îÄ Facturas.php               # Modelo de facturas
‚îÇ   ‚îú‚îÄ‚îÄ Stock.php                  # Modelo de inventario
‚îÇ   ‚îú‚îÄ‚îÄ HistoricoMovimientos.php   # Hist√≥rico de movimientos
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ views/              # Vistas de la aplicaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ productos/     # Vistas de productos
‚îÇ   ‚îú‚îÄ‚îÄ clientes/      # Vistas de clientes
‚îÇ   ‚îú‚îÄ‚îÄ facturas/      # Vistas de facturas
‚îÇ   ‚îú‚îÄ‚îÄ pos/           # Vista del sistema POS
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ web/                # Archivos web p√∫blicos
‚îÇ   ‚îú‚îÄ‚îÄ uploads/       # Archivos subidos (im√°genes de productos)
‚îÇ   ‚îî‚îÄ‚îÄ assets/        # Assets compilados
‚îî‚îÄ‚îÄ widgets/            # Widgets personalizados
    ‚îî‚îÄ‚îÄ DollarPriceWidget.php # Widget de precios del d√≥lar
```



## üîß Requisitos del Sistema

- **PHP**: >= 7.4.0
- **Base de datos**: MySQL/MariaDB
- **Servidor web**: Apache/Nginx
- **Extensiones PHP requeridas**:
  - PDO MySQL
  - GD (para manejo de im√°genes)
  - cURL (para autenticaci√≥n Google)
  - OpenSSL
  - Mbstring


## üöÄ Instalaci√≥n

### 1. Clonar el Repositorio

```bash
git clone [URL_DEL_REPOSITORIO] hava-inventario
cd hava-inventario
```

### 2. Instalar Dependencias

Si no tienes [Composer](https://getcomposer.org/), inst√°lalo siguiendo las instrucciones en [getcomposer.org](https://getcomposer.org/doc/00-intro.md#installation-nix).

```bash
composer install
```

### 3. Configurar Base de Datos

1. Crea una base de datos MySQL/MariaDB
2. Edita el archivo `config/db.php` con tus datos de conexi√≥n:

```php
return [
    'class' => 'yii\db\Connection',
    'dsn' => 'mysql:host=localhost;dbname=hava_inventario',
    'username' => 'tu_usuario',
    'password' => 'tu_contrase√±a',
    'charset' => 'utf8',
];
```

### 4. Configurar Autenticaci√≥n Google (Opcional)

1. Copia el archivo de ejemplo: `cp config/google-credentials.example.php config/google-credentials.php`
2. Configura tus credenciales de Google OAuth siguiendo la gu√≠a en `GOOGLE_AUTH_SETUP.md`

### 5. Configurar Permisos

```bash
# En sistemas Unix/Linux
chmod 777 runtime web/assets web/uploads
chmod 755 yii
```

### 6. Acceder a la Aplicaci√≥n

Configura tu servidor web para que apunte al directorio `web/` y accede a:

```
http://localhost/hava-inventario/web/
```


### 7. Instalaci√≥n con Docker (Alternativa)

Si prefieres usar Docker:

```bash
# Actualizar dependencias
docker-compose run --rm php composer update --prefer-dist

# Ejecutar instalaci√≥n
docker-compose run --rm php composer install    

# Iniciar contenedores
docker-compose up -d
```

Accede a la aplicaci√≥n en: `http://127.0.0.1:8000`

**Notas Docker:**
- Versi√≥n m√≠nima requerida: Docker Engine `17.04`
- La configuraci√≥n usa un volumen host en `.docker-composer` para cach√© de composer


## ‚öôÔ∏è Configuraci√≥n

### Configuraci√≥n Inicial de Usuarios

Despu√©s de la instalaci√≥n, crea los usuarios iniciales ejecutando desde la consola:

```php
// Crear usuario administrador
use app\models\Usuarios;
$admin = Usuarios::createUser('admin', 'admin123', 'Administrador', 1);

// Crear usuario demo
$demo = Usuarios::createUser('demo', 'demo123', 'Usuario Demo', 0);
```

### Estructura de Base de Datos

El sistema requiere las siguientes tablas principales:

- **usuarios**: Gesti√≥n de usuarios del sistema
- **productos**: Cat√°logo de productos
- **clientes**: Base de datos de clientes
- **facturas**: Registro de facturas
- **items_factura**: Detalles de items por factura
- **stock**: Control de inventario por ubicaci√≥n
- **entradas**: Registro de entradas de mercanc√≠a
- **salidas**: Registro de salidas de mercanc√≠a
- **historico_movimientos**: Hist√≥rico completo de movimientos
- **historico_cobros**: Seguimiento de cobros y pagos
- **lugares**: Ubicaciones/almacenes
- **categorias**: Categor√≠as de productos
- **proveedores**: Base de datos de proveedores
- **historico_precios_dolar**: Precios hist√≥ricos del d√≥lar

### Configuraci√≥n de Autenticaci√≥n Google

Para habilitar el login con Google, consulta la documentaci√≥n detallada en `GOOGLE_AUTH_SETUP.md`.

**NOTAS:**
- La base de datos debe crearse manualmente antes de acceder a la aplicaci√≥n
- Revisa y edita los archivos en el directorio `config/` seg√∫n tus necesidades
- Consulta la documentaci√≥n en el directorio `tests/` para informaci√≥n sobre pruebas


## üéØ Funcionalidades del Sistema

### üì¶ Gesti√≥n de Productos
- **Cat√°logo completo**: Marca, modelo, color, SKU, descripci√≥n
- **Control de precios**: Costo y precio de venta
- **C√≥digos de barras**: Identificaci√≥n √∫nica por producto
- **Im√°genes**: Hasta 10 fotos por producto
- **Categorizaci√≥n**: Organizaci√≥n por categor√≠as
- **Ubicaciones**: Control por almac√©n/lugar
- **Stock autom√°tico**: Creaci√≥n de inventario inicial

### üè™ Sistema POS (Punto de Venta)
- **Interfaz intuitiva**: B√∫squeda r√°pida de productos
- **Facturaci√≥n en tiempo real**: Generaci√≥n autom√°tica de facturas
- **Gesti√≥n de clientes**: Selecci√≥n y seguimiento de clientes
- **Control de stock**: Actualizaci√≥n autom√°tica del inventario
- **Conversi√≥n de monedas**: Precios en bol√≠vares y d√≥lares
- **Edici√≥n de facturas**: Modificaci√≥n con registro de devoluciones

### üë• Gesti√≥n de Clientes
- **Base de datos completa**: Informaci√≥n detallada de clientes
- **Estados de cuenta**: Solvente/Moroso autom√°tico
- **Hist√≥rico de compras**: Seguimiento de transacciones
- **Cuentas por cobrar**: Control de deudas pendientes

### üìä Control de Inventario
- **Stock por ubicaci√≥n**: Inventario separado por almac√©n
- **Entradas y salidas**: Registro detallado de movimientos
- **Hist√≥rico completo**: Trazabilidad de todos los movimientos
- **Reportes de inventario**: Valorizaci√≥n y cantidades
- **Alertas de stock**: Control de productos con bajo inventario

### üí∞ Sistema de Facturaci√≥n
- **Facturas detalladas**: Items con precios y cantidades
- **C√≥digos √∫nicos**: Numeraci√≥n autom√°tica
- **M√∫ltiples monedas**: Soporte para bol√≠vares y d√≥lares
- **Hist√≥rico de cobros**: Seguimiento de pagos
- **Estados de factura**: Pendiente/Pagada/Parcial

### üìà Reportes y An√°lisis
- **Dashboard principal**: Resumen ejecutivo del negocio
- **Valor del inventario**: C√°lculo autom√°tico del valor total
- **An√°lisis de clientes**: Proporci√≥n solventes vs morosos
- **Hist√≥rico de precios**: Seguimiento del d√≥lar oficial y paralelo
- **Movimientos detallados**: Registro completo de transacciones

## üß™ Pruebas

Las pruebas est√°n ubicadas en el directorio `tests/` y est√°n desarrolladas con [Codeception PHP Testing Framework](https://codeception.com/).

Por defecto, hay 3 suites de pruebas:
- `unit`: Pruebas unitarias de componentes
- `functional`: Pruebas de interacci√≥n del usuario  
- `acceptance`: Pruebas en navegador real (deshabilitadas por defecto)

### Ejecutar Pruebas

```bash
# Ejecutar todas las pruebas
vendor/bin/codecept run

# Solo pruebas unitarias y funcionales
vendor/bin/codecept run unit,functional

# Con cobertura de c√≥digo
vendor/bin/codecept run --coverage --coverage-html --coverage-xml
```

La salida de cobertura se encuentra en `tests/_output/`.

## üìö Documentaci√≥n Adicional

El proyecto incluye documentaci√≥n detallada en archivos espec√≠ficos:

- **`FORMULARIO_PRODUCTOS.md`**: Gu√≠a completa del formulario de productos y gesti√≥n de im√°genes
- **`GOOGLE_AUTH_SETUP.md`**: Configuraci√≥n paso a paso de autenticaci√≥n con Google OAuth
- **`MIGRACION_USUARIOS.md`**: Documentaci√≥n del sistema de usuarios y migraci√≥n
- **`REGISTRO_DEVOLUCIONES.md`**: Funcionalidad de devoluciones en edici√≥n de facturas
- **`PRUEBAS_DEVOLUCIONES.md`**: Casos de prueba para el sistema de devoluciones

## üîê Seguridad

- **Autenticaci√≥n robusta**: Sistema de usuarios con encriptaci√≥n segura
- **Validaci√≥n de datos**: Validaciones tanto en cliente como servidor
- **Protecci√≥n CSRF**: Tokens de validaci√≥n en formularios
- **Subida segura de archivos**: Validaci√≥n de tipos y tama√±os de imagen
- **Transacciones de BD**: Integridad de datos garantizada

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **Framework**: Yii 2.0.45
- **Frontend**: Bootstrap 5, jQuery, CSS3
- **Base de datos**: MySQL/MariaDB con Active Record
- **Autenticaci√≥n**: Yii Auth + Google OAuth 2.0
- **Subida de archivos**: Yii UploadedFile
- **Testing**: Codeception Framework

## ü§ù Contribuci√≥n

Para contribuir al proyecto:

1. Fork el repositorio
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Crea un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia BSD-3-Clause. Ver el archivo `LICENSE.md` para m√°s detalles.

## üìû Soporte

Para soporte t√©cnico o consultas sobre el sistema:

- Revisa la documentaci√≥n en los archivos `.md` del proyecto
- Consulta los issues existentes en el repositorio
- Crea un nuevo issue para reportar bugs o solicitar features

---

**Hava Inventario** - Sistema completo de gesti√≥n de inventarios desarrollado con ‚ù§Ô∏è usando Yii Framework.
